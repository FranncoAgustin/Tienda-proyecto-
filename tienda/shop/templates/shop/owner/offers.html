{% extends "base.html" %}
{% block title %}Ofertas / Promos{% endblock %}
{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h5 mb-0">Ofertas / Promociones</h1>
    <a class="btn btn-sm btn-outline-secondary" href="{% url 'owner_dashboard' %}">← Volver</a>
  </div>

  <div class="card mb-4">
    <div class="card-header">Nueva promoción</div>
    <div class="card-body">
      <form method="post" class="row g-3">
        {% csrf_token %}
        <div class="col-md-4">
          <label class="form-label">Nombre</label>
          <input name="name" class="form-control" required>
        </div>
        <div class="col-md-2">
          <label class="form-label">% Descuento</label>
          <input name="percent" type="number" min="1" max="90" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Inicio</label>
          <input name="start_at" type="datetime-local" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Fin</label>
          <input name="end_at" type="datetime-local" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Filtrar por técnica</label>
          <select name="tech" class="form-select">
            <option value="">(todas)</option>
            <option value="SUB">Sublimación</option>
            <option value="LAS">Grabado láser</option>
            <option value="3D">Impresión 3D</option>
            <option value="OTR">Otro</option>
          </select>
        </div>
        <div class="col-md-9">
          <label class="form-label">SKUs (uno por línea) — opcional</label>
          <textarea name="skus" class="form-control" rows="3" placeholder="SKU-001&#10;SKU-002"></textarea>
          <div class="form-text">Si cargás SKUs, se ignora el filtro por técnica.</div>
        </div>
        <div class="col-12">
          <div class="form-check">
            <input type="checkbox" name="active" class="form-check-input" id="fActive" checked>
            <label class="form-check-label" for="fActive">Activa</label>
          </div>
        </div>
        <div class="col-12">
          <button class="btn btn-primary">Crear promoción</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Promociones existentes</div>
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Nombre</th><th>%</th><th>Ventana</th><th>Técnica</th><th>Productos</th><th>Estado</th>
          </tr>
        </thead>
        <tbody>
          {% for pr in promos %}
          <tr>
            <td class="fw-semibold">{{ pr.name }}</td>
            <td>{{ pr.percent }}%</td>
            <td>{{ pr.start_at|date:"d/m H:i" }} → {{ pr.end_at|date:"d/m H:i" }}</td>
            <td>{{ pr.get_tech_filter_display|default:"(todas)" }}</td>
            <td>
              {% if pr.products.all %}
                <span class="badge text-bg-light">{{ pr.products.count }} prod(s)</span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if pr.active %}
                <span class="badge text-bg-success">Activa</span>
              {% else %}
                <span class="badge text-bg-secondary">Inactiva</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-center text-muted py-4">No hay promociones.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
